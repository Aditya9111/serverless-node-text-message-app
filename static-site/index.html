<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="main.css" rel="stylesheet">
</head>

<body>
  <div class="container">
    <div class="">
        <div id='logo'>
          <img src="http://thewoofgarden.com/img/projects/riley_and_bella.jpg" />
        </div>
        <h3>Woof Garden Text Notification System</h3>
        <div id="message"></div>
        <div class="inputs">
          <input id="phone-number" placeholder="Phone Number" />
          <input id="text" placeholder="Input your text message" />
        </div>
        <textarea style="margin-bottom: 20px" id="message" rows="3" placeholder="Your message"></textarea>
        <div class="g-recaptcha" data-sitekey="6LcXNhAUAAAAAD5LX_MTjJC7cNDuDPesw2NKljjH"></div>
        <div class='api-actions'>
          <button id="send-sms" class="btn">Send Text</button>
        </div>
          Adapted from 
        <a href="https://github.com/serverless/examples/">Serverless' Examples</a>
        
    </div>
  </div>
  <!-- polyfill browser fetch -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.1/fetch.js"></script>
  <script>
    // Replace the YOUR_API_ENDPOINT_URL with yours
    // It should look something like this:
    // https://qw324asdasd.execute-api.us-east-1.amazonaws.com/dev/api/sendSms
    const API_ENDPOINT = 'YOUR_API_ENDPOINT_URL';
    const messageDiv = document.getElementById('message')
    // Handle public api call
    document.getElementById('send-text').addEventListener('click', function () {
      const captchtaResponse = grecaptcha.getResponse()
      console.log(captchta_response);
      const text = document.getElementById('text').value
      const number = document.getElementById('phone-number').value

      if (!captchtaResponse) {
        messageDiv.innerHTML = 'Complete the Captcha please!'
        return false
      }

      if (!text) {
        messageDiv.innerHTML = 'Remember to enter a message!'
        return false
      }

      if (!number) {
        messageDiv.innerHTML = 'Don\' forget to enter a phone number!'
        return false
      }

      const data = JSON.stringify({
        to: number,
        message: text,
        captcha: captchtaResponse
      })

      // post to API with native browser Fetch
      const getdata = fetch(API_ENDPOINT, {
        headers: {
          "Content-type": "application/json"
        },
        method: 'POST',
        body: data,
        mode: 'cors',
        cache: false,
      });

      getdata.then(function(response) {
        response.json().then(function(data) {
          console.log('Response:', data);
          const body = JSON.parse(data.body);
          messageDiv.textContent = '';
          messageDiv.textContent = (body && body.message) ? body.message : '';
        });
      }).catch(function(err) {
        console.log(err)
      });
    });
  </script>
</body>
</html>
